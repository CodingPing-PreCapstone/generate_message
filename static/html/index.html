<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 문자 생성</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <div class="left-panel">
            <h1>AI 문자 생성</h1>
            <form id="messageForm">
                <label>발송 목적 및 내용</label>
                <textarea id="message" placeholder="문구 생성 명령 입력" class="large-textarea" required></textarea>
                <label>중요 키워드(선택)</label>
                <div class="keyword-container">
                    <textarea id="keyword" placeholder="입력한 키워드가 생성 결과에 포함될 확률이 높아집니다."
                        class="small-textarea"></textarea>
                    <button type="button" id="addKeywordButton">추가</button>
                </div>
                <div style="height: 100px;"></div>
                <button type="submit">AI 문자 생성</button>
            </form>
        </div>

        <div class="right-panel">
            <div class="result-placeholder">
                생성결과가 없습니다.<br>뿌리오 AI 기능을 이용해보세요!
            </div>
        </div>
    </div>
    <script>
        document.getElementById('messageForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const message = document.getElementById('message').value;
            const keyword = document.getElementById('keyword').value;

            try {
                const response = await fetch('http://127.0.0.1:5000/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, keyword }),
                });

                const data = await response.json();

                if(response.ok) {
                    const resultPlaceholder = document.querySelector('.result-placeholder');
                    resultPlaceholder.innerHTML = '';  // 기존 내용 비우기

                    // 배열의 각 메시지를 <p> 태그로 출력
                        data.result_message.forEach((msg, index) => {
                const messageBox = document.createElement('div');
                messageBox.className = 'message-box';  // 스타일을 위한 클래스 추가

                messageBox.innerHTML = `
                    <p><strong>예시 ${index + 1}:</strong></p>
                    <p>${msg}</p>
                    <div class="button-group">
                        <button class="btn-delete">삭제</button>
                        <button class="btn-save">내 문자함 저장</button>
                        <button class="btn-use">메시지 사용</button>
                    </div>
                `;

                resultPlaceholder.appendChild(messageBox);

                // 버튼 이벤트 리스너 추가
                messageBox.querySelector('.btn-delete').addEventListener('click', () => {
                    resultPlaceholder.removeChild(messageBox);  // 해당 박스 삭제
                });

                messageBox.querySelector('.btn-save').addEventListener('click', () => {
                    alert('메시지가 저장되었습니다!');  // 내 문자함 저장 로직 추가 가능
                });

                messageBox.querySelector('.btn-use').addEventListener('click', () => {
                    alert('이 메시지를 사용합니다!');  // 메시지 사용 로직 추가 가능
                });
            });
        } else {
            alert('문자 생성 실패: ' + (data.error || '알 수 없는 오류'));
        }
            } catch (error) {
                console.error('오류 발생:', error);
                alert('서버 요청 중 오류가 발생했습니다.');
            }
        });
    </script>
</body>

</html>